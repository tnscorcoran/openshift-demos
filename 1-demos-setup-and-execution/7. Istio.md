### Assumptions / Notes I made. Correct as appropriate for your setup
- developer user has credentials developer:developer
- admin user has credentials system:admin
- Using a self signed cert which requires relaxing security stringencies (--insecure-skip-tls-verify)
- I use my names for projects and apps - you probably want to name your differently
- Open JDK image streams are already available. If not run this as admin: 
  - oc create -f ./openjdk-s2i-imagestream.json -n openshift
- Substitute your routes/URLS for my example ones
- Some commands are deprecated. These will be fioxed ina future release
- This example is taken from this very cool workshop: https://github.com/RedHat-Middleware-Workshops/modernize-apps-katacoda/blob/master/docs/cdk-docs/md/06-resilient-apps.md

### Steps
- **_Note - you'll need cluster Admin access to setup this_**  
- **_Note - this uses an older version of Istio. We will be updating it shortly_**  
- **_Setup Istio and the sample app_**  
  - oc login https://your-openshift-host -u system:admin --insecure-skip-tls-verify
  - **_Run the 2 scripts located in this repo_**  
  - oc new-project istio-system
  - ./install-istio.sh
  - ./install-sample-app.sh
  - cd ~/istio-0.6.0
- **_Test using the Istio Ingress route that's been setup for you - append /productpage _**  
  - http://istio-ingress-istio-system.apps.1.1.1.1.nip.io/productpage
- **_In a new terminal window, apply some load_**  
  - while sleep .2; do curl -o /dev/null -s -w "%{http_code}\n" http://istio-ingress-istio-system.apps.1.1.1.1.nip.io/productpage; done  
- **_Test the visualisation tools Istio has setup for you Prometheus, Grafana and Jaeger_**  
  - http://grafana-istio-system.apps.1.1.1.1.nip.io/d/1/istio-dashboard?refresh=5s&orgId=1
  - http://prometheus-istio-system.apps.1.1.1.1.nip.io/graph?g0.range_input=15m&g0.expr=http_requests_total&g0.tab=0
  - http://jaeger-query-istio-system.apps.1.1.1.1.nip.io
- **_Apply Traffic Management_**  
  - **_ 1 SEND ALL TRAFFIC TO V1 (no ratings) and test it_**  
    - oc create -f samples/bookinfo/kube/route-rule-all-v1.yaml
    - **_Repeatedly hit page - all traffic goes to V1 (no stars)_**  
      - http://istio-ingress-istio-system.apps.1.1.1.1.nip.io/productpage
    - **_Drill into Reviews page on Grafana to see same_**  
      - http://grafana-istio-system.apps.1.1.1.1.nip.io
    - **_Undo this rule_**  
      - oc delete -f samples/bookinfo/kube/route-rule-all-v1.yaml
  - **_2 AB Testing for user Jason (all V2 - black stars)_**  
    - oc create -f samples/bookinfo/kube/route-rule-reviews-test-v2.yaml
    - oc get routerule reviews-test-v2 -o yaml
    - **_Login as jason:jason_ and repeated refresh page - always shows V2**  
      - http://istio-ingress-istio-system.apps.1.1.1.1.nip.io/productpage
    - **_Undo this rule_**  
      - oc delete -f samples/bookinfo/kube/route-rule-reviews-test-v2.yaml
  - **_3 Canary release on 50% of our users to V3 (red stars)_**  
    - oc create -f samples/bookinfo/kube/route-rule-reviews-50-v3.yaml
    - oc get routerule reviews-test-v2 -o yaml
    - **_Repeatedly refresh page - shows 50% to V1, 50% to V3**  
      - http://istio-ingress-istio-system.apps.1.1.1.1.nip.io/productpage
    - **_Drill into Reviews page on Grafana to see same_**  
      - http://grafana-istio-system.apps.1.1.1.1.nip.io
    - **_Undo this rule_**  
      - oc delete -f samples/bookinfo/kube/route-rule-reviews-50-v3.yaml
  - **_4 Fully Release V3 (red stars) _**  
    - oc create -f samples/bookinfo/kube/route-rule-reviews-v3.yaml
    - **_Repeatedly refresh page - all V3**  
      - http://istio-ingress-istio-system.apps.1.1.1.1.nip.io/productpage
    - **_Drill into Reviews page on Grafana to see same_**  
      - http://grafana-istio-system.apps.1.1.1.1.nip.io
    - **_Undo this rule_**  
      - oc delete -f samples/bookinfo/kube/route-rule-reviews-v3.yaml
  - **_5 Rate Limiting _**  
    - **_ Generate heavier load _**  
      - while sleep .05; do curl -o /dev/null -s -w "%{http_code}\n" http://istio-ingress-istio-system.apps.52.14.23.175.nip.io/productpage; done    
    - oc create -f samples/bookinfo/kube/mixer-rule-ratings-ratelimit.yaml
    - oc get memquota handler -o yaml
    - **_ Look at Ratings - see there are some 429s (too many requests as rate limit exceeded) nd some 200 OKs _**  
      - http://grafana-istio-system.apps.1.1.1.1.nip.io
